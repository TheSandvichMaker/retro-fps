// Generated by metagen.lua

void shader_texture_viewer_set_draw_params(rhi_command_list_t *list, texture_viewer_draw_parameters_t *params)
{
	rhi_validate_texture_srv(params->texture, S("texture_viewer_draw_parameters_t::texture"), 0);
	rhi_set_parameters(list, 0, params, sizeof(*params));
}

#define DF_SHADER_TEXTURE_VIEWER_SOURCE_CODE \
	"// Generated by metagen.lua\n" \
	"\n" \
	"#include \"bindless.hlsli\"\n" \
	"\n" \
	"#include \"common.hlsli\"\n" \
	"\n" \
	"struct texture_viewer_draw_parameters_t\n" \
	"{\n" \
	"	df::Resource< Texture2D< float4 > > texture;\n" \
	"	float2 texture_dim;\n" \
	"	uint flags;\n" \
	"	float hdr_range;\n" \
	"	int sample_count;\n" \
	"};\n" \
	"\n" \
	"ConstantBuffer< texture_viewer_draw_parameters_t > draw : register(b0);\n" \
	"\n" \
	"\n" \
	"\n" \
	"float4 texture_viewer_ps(fullscreen_triangle_vs_out_t IN) : SV_Target\n" \
	"{\n" \
	"	float2 uv = IN.uv;\n" \
	"	uint2  co = floor(uv*draw.texture_dim);\n" \
	"\n" \
	"	int sample_count = draw.sample_count;\n" \
	"\n" \
	"	float4 color = 0.0;\n" \
	"\n" \
	"	if (sample_count > 1)\n" \
	"	{\n" \
	"		Texture2DMS<float4> texture = draw.texture.GetAs< Texture2DMS<float4> >();\n" \
	"\n" \
	"		for (int i = 0; i < sample_count; i++)\n" \
	"		{\n" \
	"			color += texture.Load(co, i);\n" \
	"		}\n" \
	"\n" \
	"		color /= (float)sample_count;\n" \
	"	}\n" \
	"	else\n" \
	"	{\n" \
	"		Texture2D<float4> texture = draw.texture.Get();\n" \
	"		color = texture.Sample(df::s_linear_border, uv);\n" \
	"	}\n" \
	"\n" \
	"	color.rgb *= draw.hdr_range;\n" \
	"\n" \
	"	if (draw.flags & 0x1)\n" \
	"	{\n" \
	"		color.rgb = 1.0 - exp(-color.rgb);\n" \
	"	}\n" \
	"\n" \
	"	return color;\n" \
	"}\n" \
	"\n" \
