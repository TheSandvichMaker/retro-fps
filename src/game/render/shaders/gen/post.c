// Generated by metagen.lua

void shader_post_set_draw_params(rhi_command_list_t *list, post_draw_parameters_t *params)
{
	rhi_validate_texture_srv(params->hdr_color, S("shader_post_set_draw_params"));
	rhi_set_parameters(list, 0, params, sizeof(*params));
}

#define DF_SHADER_POST_SOURCE_CODE \
	"// Generated by metagen.lua\n" \
	"\n" \
	"#include \"bindless.hlsli\"\n" \
	"\n" \
	"struct post_draw_parameters_t\n" \
	"{\n" \
	"	df::Resource< Texture2DMS< float4 > > hdr_color;\n" \
	"	uint sample_count;\n" \
	"};\n" \
	"\n" \
	"ConstantBuffer< post_draw_parameters_t > draw : register(b0);\n" \
	"\n" \
	"\n" \
	"	#include \"common.hlsli\"\n" \
	"\n" \
	"	struct VS_OUT\n" \
	"	{\n" \
	"		float4 pos : SV_POSITION;\n" \
	"		float2 uv  : TEXCOORD;\n" \
	"	};\n" \
	"\n" \
	"	VS_OUT MainVS(uint id : SV_VertexID)\n" \
	"	{\n" \
	"		VS_OUT OUT;\n" \
	"		OUT.uv  = uint2(id, id << 1) & 2;\n" \
	"		OUT.pos = float4(lerp(float2(-1, 1), float2(1, -1), OUT.uv), 0, 1);\n" \
	"		return OUT;\n" \
	"	}\n" \
	"\n" \
	"	float4 MainPS(VS_OUT IN) : SV_Target\n" \
	"	{\n" \
	"		uint2 co = uint2(IN.pos.xy);\n" \
	"\n" \
	"		Texture2DMS<float4> tex_color = draw.hdr_color.Get();\n" \
	"\n" \
	"		float4 sum = 0.0;\n" \
	"		for (uint i = 0; i < draw.sample_count; i++)\n" \
	"		{\n" \
	"			float4 color = tex_color.Load(co, i);\n" \
	"\n" \
	"			float2 sample_position = tex_color.GetSamplePosition(i);\n" \
	"\n" \
	"			float weight = 1.0 ; //smoothstep(8, 0, sample_position.x)*smoothstep(8, 0, sample_position.y);\n" \
	"\n" \
	"			// tonemap\n" \
	"			color.rgb = 1.0 - exp(-color.rgb);\n" \
	"			color.rgb *= weight;\n" \
	"\n" \
	"			sum.rgb += color.rgb;\n" \
	"			sum.a   += weight;\n" \
	"		}\n" \
	"\n" \
	"		sum.rgb *= rcp(sum.a);\n" \
	"\n" \
	"		return float4(sum.rgb, 1.0);\n" \
	"	}\n" \
	"\n" \
	"	\n" \
	"\n" \
